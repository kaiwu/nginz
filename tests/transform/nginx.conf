worker_processes 1;
error_log logs/error.log debug;
daemon off;
master_process off;

events {
    worker_connections 64;
}

http {
    access_log logs/access.log;

    upstream backend {
        server 127.0.0.1:19001;
    }

    server {
        listen 8888;

        # Extract nested object
        location /extract-object {
            proxy_pass http://backend/nested;
            transform_response $.data;
        }

        # Extract array
        location /extract-array {
            proxy_pass http://backend/with-array;
            transform_response $.items;
        }

        # Extract nested value
        location /extract-nested {
            proxy_pass http://backend/nested;
            transform_response $.data.value;
        }

        # Extract array element
        location /extract-element {
            proxy_pass http://backend/with-array;
            transform_response $.items.0;
        }

        # No transform (passthrough)
        location /passthrough {
            proxy_pass http://backend/nested;
        }

        # Non-existent path (passthrough on failure)
        location /invalid-path {
            proxy_pass http://backend/nested;
            transform_response $.nonexistent.path;
        }

        # Non-JSON response (passthrough)
        location /non-json {
            proxy_pass http://backend/text;
            transform_response $.data;
        }
    }
}
