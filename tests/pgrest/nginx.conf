daemon off;
error_log logs/error.log debug;
pid logs/nginx.pid;

events {
    worker_connections 64;
}

http {
    access_log logs/access.log;

    server {
        listen 8888;

        # RESTful API endpoint for tables
        location /api/ {
            # Connection to mock PostgreSQL server
            pgrest_pass "host=127.0.0.1 port=15432 dbname=testdb user=postgres";
        }

        # RPC endpoint for stored procedures
        location /rpc/ {
            pgrest_pass "host=127.0.0.1 port=15432 dbname=testdb user=postgres";
        }

        # JWT role-based API endpoint
        location /jwt-api/ {
            pgrest_pass "host=127.0.0.1 port=15432 dbname=testdb user=postgres";
            pgrest_jwt_secret "test-secret-key-for-hs256-jwt";
            pgrest_anon_role "anon";
            pgrest_jwt_role_claim "role";
        }

        # JWT RPC endpoint
        location /jwt-rpc/ {
            pgrest_pass "host=127.0.0.1 port=15432 dbname=testdb user=postgres";
            pgrest_jwt_secret "test-secret-key-for-hs256-jwt";
            pgrest_anon_role "anon";
        }

        # Health check endpoint
        location /health {
            echoz "OK";
        }
    }
}
