daemon off;
error_log logs/error.log debug;
pid logs/nginx.pid;

events {
    worker_connections 64;
}

http {
    access_log logs/access.log;

    server {
        listen 8888;

        # GraphQL endpoint with depth limiting and introspection disabled
        location /graphql {
            graphql on;
            graphql_max_depth 5;
            graphql_introspection off;

            proxy_pass http://127.0.0.1:19002;
            proxy_http_version 1.1;
            proxy_set_header Connection "";
        }

        # GraphQL endpoint with introspection enabled
        location /graphql-introspection {
            graphql on;
            graphql_max_depth 10;
            graphql_introspection on;

            proxy_pass http://127.0.0.1:19002;
            proxy_http_version 1.1;
            proxy_set_header Connection "";
        }

        # GraphQL endpoint with very low depth limit for testing
        location /graphql-shallow {
            graphql on;
            graphql_max_depth 2;
            graphql_introspection off;

            proxy_pass http://127.0.0.1:19002;
            proxy_http_version 1.1;
            proxy_set_header Connection "";
        }

        # GraphQL disabled (passthrough)
        location /graphql-disabled {
            graphql off;

            proxy_pass http://127.0.0.1:19002;
            proxy_http_version 1.1;
            proxy_set_header Connection "";
        }

        # Health check endpoint
        location / {
            echozn '{"status":"ok"}';
        }
    }
}
