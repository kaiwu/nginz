daemon off;
error_log logs/error.log debug;
pid logs/nginx.pid;

events {
    worker_connections 64;
}

http {
    access_log logs/access.log;

    # ACME configuration (http context)
    acme on;
    acme_email test@example.com;
    acme_storage tests/acme/runtime/acme;
    acme_server http://127.0.0.1:14000/directory;  # Mock ACME server

    # Test server with ACME enabled
    server {
        listen 8888;
        server_name test.example.com;

        acme_domain test.example.com;

        # Module intercepts /.well-known/acme-challenge/ automatically
        # No explicit location needed for challenges

        location / {
            echozn '{"status":"ok","server":"test.example.com"}';
        }
    }

    # Second test server - different domain
    server {
        listen 8889;
        server_name other.example.com;

        acme_domain other.example.com;

        location / {
            echozn '{"status":"ok","server":"other.example.com"}';
        }
    }

    # Server without ACME domain - challenges should NOT be intercepted
    server {
        listen 8890;
        server_name no-acme.example.com;

        # No acme_domain directive - module should not intercept challenges

        location / {
            echozn '{"status":"ok","server":"no-acme.example.com"}';
        }

        # Manual challenge handler (simulates non-ACME behavior)
        location /.well-known/acme-challenge/ {
            echozn '{"handler":"manual"}';
        }
    }
}
